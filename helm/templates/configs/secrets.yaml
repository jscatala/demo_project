{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: voting-secrets
  namespace: voting-data
  labels:
    app.kubernetes.io/name: voting-app
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: voting-system
    app.kubernetes.io/managed-by: helm
type: Opaque
stringData:
  # PostgreSQL credentials
  # SECURITY WARNING: These are development defaults
  # In production, use external secret management (Sealed Secrets, External Secrets Operator, Vault, etc.)
  postgres-user: {{ .Values.secrets.postgres.user | default "postgres" | quote }}
  postgres-password: {{ .Values.secrets.postgres.password | default "postgres" | quote }}

  # Full database URL for application
  database-url: {{ printf "postgresql://%s:%s@postgres.voting-data.svc.cluster.local:5432/votes" (.Values.secrets.postgres.user | default "postgres") (.Values.secrets.postgres.password | default "postgres") | quote }}

  # Redis credentials (if authentication enabled)
  redis-password: {{ .Values.secrets.redis.password | default "" | quote }}
{{- end }}
---
# Secret for API namespace (for cross-namespace access)
{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: voting-secrets
  namespace: voting-api
  labels:
    app.kubernetes.io/name: voting-app
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: voting-system
    app.kubernetes.io/managed-by: helm
type: Opaque
stringData:
  database-url: {{ printf "postgresql://%s:%s@postgres.voting-data.svc.cluster.local:5432/votes" (.Values.secrets.postgres.user | default "postgres") (.Values.secrets.postgres.password | default "postgres") | quote }}
  redis-password: {{ .Values.secrets.redis.password | default "" | quote }}
{{- end }}
---
# Secret for consumer namespace (for cross-namespace access)
{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: voting-secrets
  namespace: voting-consumer
  labels:
    app.kubernetes.io/name: voting-app
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: voting-system
    app.kubernetes.io/managed-by: helm
type: Opaque
stringData:
  database-url: {{ printf "postgresql://%s:%s@postgres.voting-data.svc.cluster.local:5432/votes" (.Values.secrets.postgres.user | default "postgres") (.Values.secrets.postgres.password | default "postgres") | quote }}
  redis-password: {{ .Values.secrets.redis.password | default "" | quote }}
{{- end }}
