# Container Vulnerability Scan Report

**Scan Date:** 2025-11-17
**Scanner:** Trivy (Docker aquasec/trivy:latest)
**Scope:** All 3 production container images
**Severity Threshold:** HIGH and CRITICAL only

## Executive Summary

Completed comprehensive vulnerability scanning of all production container images. **URGENT ACTION REQUIRED** for frontend image due to end-of-life operating system.

| Image | Version | Base OS | Vulnerabilities | Risk Level |
|-------|---------|---------|----------------|------------|
| frontend | 0.5.0 | Alpine 3.19.1 (EOL) | 3 CRITICAL, 15 HIGH | ðŸ”´ URGENT |
| api | 0.3.2 | Debian 12.12 | 2 CRITICAL, 5 HIGH | ðŸŸ¡ ACTION REQUIRED |
| consumer | 0.3.0 | Debian 13.1 | 0 HIGH/CRITICAL | ðŸŸ¢ CLEAN |

**Key Findings:**
- **Frontend**: 18 total vulnerabilities - Alpine 3.19.1 no longer supported by distribution
- **API**: 7 total vulnerabilities - 2 Python packages fixable via dependency updates
- **Consumer**: 0 vulnerabilities - clean baseline with Debian 13.1 + Python 3.13

## Detailed Findings

### Frontend (frontend:0.5.0) - URGENT

**Base Image:** Alpine 3.19.1
**Status:** âš ï¸ **END OF LIFE** - No longer supported by distribution
**Total Vulnerabilities:** 18 (3 CRITICAL, 15 HIGH)

#### CRITICAL Vulnerabilities (3)

| Package | CVE | Description | Fixed Version |
|---------|-----|-------------|---------------|
| libexpat 2.6.2-r0 | CVE-2024-45491 | Integer Overflow in XML_GetBuffer | 2.6.3-r0 |
| libexpat 2.6.2-r0 | CVE-2024-45492 | Integer overflow in function nextScaffoldPart | 2.6.3-r0 |
| libxml2 2.12.6-r0 | CVE-2024-56171 | Use-After-Free in xmlValidatePushElement | 2.12.7-r0 |

#### HIGH Vulnerabilities (15)

| Package | CVE | Description |
|---------|-----|-------------|
| curl 8.7.1-r0 | CVE-2024-2398 | HTTP/2 push headers memory-leak |
| curl 8.7.1-r0 | CVE-2024-6197 | freeing stack buffer in utf8asn1str |
| libcrypto3 3.2.1-r1 | CVE-2024-6119 | Denial of service in X.509 name checks |
| libssl3 3.2.1-r1 | CVE-2024-6119 | Denial of service in X.509 name checks |
| libexpat 2.6.2-r0 | CVE-2024-45490 | Negative Length Parsing Vulnerability |
| libexpat 2.6.2-r0 | CVE-2024-8176 | xmlparse.c in Expat (libexpat) |
| libxml2 2.12.6-r0 | CVE-2025-24928 | NULL pointer dereference in xmlDictLookup |
| libxml2 2.12.6-r0 | CVE-2025-27113 | Integer overflow in htmlParseChunk |
| libxml2 2.12.6-r0 | CVE-2025-32414 | Integer underflow in xmlBufAvail |
| libxml2 2.12.6-r0 | CVE-2025-32415 | Out-of-bounds write in xmlBufGrowInternal |
| libxslt 1.1.39-r1 | CVE-2024-55549 | use-after-free via uninitialized member |
| libxslt 1.1.39-r1 | CVE-2025-24855 | NULL pointer dereference in xsltNumberFormatGetMultipleLevel |
| xz-libs 5.4.6-r0 | CVE-2025-31115 | Arbitrary Command Execution in .xz files |

**Root Cause:** Alpine 3.19.1 reached end-of-life and no longer receives security updates from the distribution maintainers.

**Impact:**
- All 18 vulnerabilities stem from outdated base OS packages
- No security patches available for Alpine 3.19.1
- Vulnerable to XML parsing exploits (integer overflows, use-after-free)
- OpenSSL DoS exposure
- HTTP/2 and curl memory leaks

---

### API (api:0.3.2) - ACTION REQUIRED

**Base Image:** Debian 12.12 (distroless variant)
**Status:** âš ï¸ Some vulnerabilities fixable
**Total Vulnerabilities:** 7 (2 CRITICAL, 5 HIGH)

#### CRITICAL Vulnerabilities (2)

| Package | CVE | Description | Status |
|---------|-----|-------------|--------|
| libsqlite3-0 3.40.1-2+deb12u1 | CVE-2025-7458 | Integer overflow in SQLite | affected, no fix available |
| zlib1g 1:1.2.13.dfsg-1 | CVE-2023-45853 | Heap-based buffer overflow | **will_not_fix** |

#### HIGH Vulnerabilities (5)

**Debian Base Packages (3):**

| Package | CVE | Description | Status |
|---------|-----|-------------|--------|
| python3.11 3.11.2-6+deb12u4 | CVE-2025-8194 | Infinite loop parsing tarfile | affected |
| python3.11-minimal 3.11.2-6+deb12u4 | CVE-2025-8194 | Infinite loop parsing tarfile | affected |
| libpython3.11-stdlib 3.11.2-6+deb12u4 | CVE-2025-8194 | Infinite loop parsing tarfile | affected |

**Python Package Vulnerabilities (2 - FIXABLE):**

| Package | Installed | CVE | Description | Fixed In |
|---------|-----------|-----|-------------|----------|
| python-multipart | 0.0.9 | CVE-2024-53981 | DoS via multipart form data | **0.0.18** |
| starlette | 0.38.6 | CVE-2024-47874 | DoS via malformed multipart data | **0.40.0** |

**Impact:**
- SQLite integer overflow (no fix available from Debian)
- zlib heap overflow (Debian marked will_not_fix)
- Python 3.11 tarfile parsing DoS (waiting for Debian patch)
- **Immediate fix available** for python-multipart and starlette by upgrading dependencies

---

### Consumer (consumer:0.3.0) - CLEAN âœ…

**Base Image:** Debian 13.1
**Python Version:** 3.13
**Status:** ðŸŸ¢ **NO HIGH/CRITICAL VULNERABILITIES**

**Scan Result:**
```
Total: 0 (UNKNOWN: 0, LOW: 0, MEDIUM: 0, HIGH: 0, CRITICAL: 0)
```

**Success Factors:**
- Newer Debian base image (13.1 vs 12.12 in API)
- Latest Python version (3.13 vs 3.11 in API)
- Minimal dependency footprint
- Clean asyncpg, redis, structlog packages

---

## Remediation Plan

### 1. Frontend - URGENT (Priority: P0)

**Issue:** Alpine 3.19.1 end-of-life with 18 HIGH/CRITICAL vulnerabilities

**Recommended Actions:**

**Option A - Upgrade Alpine (Quick Fix):**
```dockerfile
FROM node:20-alpine3.21 AS builder  # 3.19 â†’ 3.21 (current stable)
# ... existing build steps ...

FROM nginx:1.25-alpine3.21  # 3.19 â†’ 3.21
```
- **Effort:** Low (change 2 lines)
- **Risk:** Low (Alpine maintains compatibility)
- **Timeline:** Immediate

**Option B - Switch to Debian (Long-term):**
```dockerfile
FROM node:20-bookworm-slim AS builder
# ... existing build steps ...

FROM nginx:1.25-bookworm  # Debian-based
```
- **Effort:** Medium (requires testing)
- **Benefit:** Better long-term support, aligns with API/Consumer base
- **Timeline:** 1-2 days

**Recommendation:** Execute Option A immediately for security, evaluate Option B for next release.

---

### 2. API - HIGH (Priority: P1)

**Issue:** 2 CRITICAL (unfixable) + 5 HIGH (2 fixable Python packages)

**Immediate Actions (Fixable):**

Update `api/requirements.txt`:
```diff
- python-multipart==0.0.9
+ python-multipart==0.0.18  # Fixes CVE-2024-53981
- starlette==0.38.6
+ starlette==0.40.0  # Fixes CVE-2024-47874
```

**Commands:**
```bash
cd api
# Update dependencies
pip install python-multipart==0.0.18 starlette==0.40.0
pip freeze > requirements.txt

# Rebuild image
docker build -t api:0.3.3 .

# Run tests
pytest tests/
```

**Timeline:** 1-2 hours

**Unfixable Vulnerabilities (Accept Risk):**

1. **libsqlite3-0 (CVE-2025-7458)**: Integer overflow
   - **Mitigation:** API doesn't use SQLite (uses PostgreSQL)
   - **Risk:** Low - unused library in distroless base
   - **Action:** Document as accepted risk

2. **zlib1g (CVE-2023-45853)**: Heap buffer overflow
   - **Mitigation:** Debian marked will_not_fix (likely false positive or low exploitability)
   - **Risk:** Low - compression library with limited attack surface in our use case
   - **Action:** Document as accepted risk, monitor for Debian updates

3. **Python 3.11 (CVE-2025-8194)**: Tarfile parsing DoS
   - **Mitigation:** API doesn't process tarfiles
   - **Risk:** Low - no tarfile handling in application code
   - **Action:** Monitor Debian security updates for Python 3.11 patch

---

### 3. Consumer - MAINTAIN (Priority: P2)

**Status:** Clean baseline - no action required

**Ongoing Actions:**
- Continue using Debian 13.1 base
- Keep Python 3.13 updated
- Regular monthly scans to maintain clean status

---

## Verification Steps

After implementing remediation:

1. **Rebuild all images:**
```bash
# Frontend (with Alpine 3.21)
docker build -t frontend:0.5.1 frontend/

# API (with updated dependencies)
docker build -t api:0.3.3 api/

# Consumer (no changes)
docker build -t consumer:0.3.0 consumer/
```

2. **Re-scan for vulnerabilities:**
```bash
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy:latest image --severity HIGH,CRITICAL frontend:0.5.1

docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy:latest image --severity HIGH,CRITICAL api:0.3.3

docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy:latest image --severity HIGH,CRITICAL consumer:0.3.0
```

3. **Run full test suite:**
```bash
./scripts/run-unit-tests.sh all
./scripts/run-integration-tests.sh
```

4. **Deploy and validate:**
```bash
helm upgrade voting-app ./helm -f helm/values-local.yaml
kubectl rollout status deployment -n voting-frontend frontend
kubectl rollout status deployment -n voting-api api
kubectl rollout status deployment -n voting-consumer consumer
```

---

## Risk Assessment

### Current Risk Levels

| Component | Severity | Exploitability | Business Impact | Overall Risk |
|-----------|----------|----------------|-----------------|--------------|
| Frontend (Alpine EOL) | CRITICAL | HIGH | HIGH | ðŸ”´ **CRITICAL** |
| API (Python packages) | HIGH | MEDIUM | MEDIUM | ðŸŸ¡ **HIGH** |
| API (Base OS) | CRITICAL | LOW | LOW | ðŸŸ¡ **MEDIUM** |
| Consumer | N/A | N/A | N/A | ðŸŸ¢ **LOW** |

### Mitigation Timeline

- âœ… **Day 0 (Today)**: Documentation complete
- ðŸ”„ **Day 1**: Upgrade Frontend to Alpine 3.21, rebuild and re-scan
- ðŸ”„ **Day 2**: Update API Python dependencies (python-multipart, starlette), rebuild and re-scan
- ðŸ“… **Week 1**: Document accepted risks for unfixable API vulnerabilities
- ðŸ“… **Week 2**: Evaluate Debian migration for Frontend (long-term)

---

## Scanning Methodology

**Tool:** Trivy v0.58.0 (Docker container: aquasec/trivy:latest)
**Command:**
```bash
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy:latest image --severity HIGH,CRITICAL <image>:<tag>
```

**Severity Levels:**
- **CRITICAL**: Exploitable vulnerabilities with severe impact (RCE, privilege escalation)
- **HIGH**: Significant vulnerabilities requiring attention (DoS, information disclosure)
- **MEDIUM**: Moderate impact vulnerabilities (filtered out in this scan)
- **LOW**: Minor issues (filtered out in this scan)

**Scope:**
- OS packages (Alpine apk, Debian apt)
- Language-specific packages (Python pip)
- Base image vulnerabilities
- Transitive dependencies

**Exclusions:**
- MEDIUM and below severity
- Historical/outdated CVEs without CVSS scores
- False positives (manually validated)

---

## Recommendations for Future Releases

1. **Standardize on Debian base images** across all services for consistent security posture
2. **Automate vulnerability scanning** in CI/CD pipeline:
   ```yaml
   # .github/workflows/security.yml
   - name: Trivy scan
     run: trivy image --severity HIGH,CRITICAL --exit-code 1 ${{ env.IMAGE }}
   ```
3. **Implement monthly security review** schedule:
   - Scan all production images
   - Review CVE database updates
   - Update base images and dependencies
4. **Add Trivy scan to pre-release checklist** in CONTRIBUTING.md
5. **Consider Trivy DB caching** for faster local scans:
   ```bash
   docker run --rm -v trivy-cache:/root/.cache/ aquasec/trivy:latest image <image>
   ```

---

## References

- **Trivy Documentation**: https://aquasecurity.github.io/trivy/
- **Alpine Linux Releases**: https://alpinelinux.org/releases/
- **Debian Security Tracker**: https://security-tracker.debian.org/
- **CVE Database**: https://cve.mitre.org/
- **NIST NVD**: https://nvd.nist.gov/

---

**Review Status:** Initial scan complete, remediation plan proposed
**Next Review Date:** 2025-12-17 (30 days)
